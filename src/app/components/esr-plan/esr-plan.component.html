<div id="gesamt" class="">
  <h1>ESR-Plan</h1>

  <div class="esrWahl noprint">
    <button class="noprint" (click)="toggle()"> Termine </button>
  </div>

  <button class="noprint" (click)="print()">
    Gesamt-Epochenpläne
    <ng-container *ngIf="counter2%2==0">
      einblenden
    </ng-container>
    <ng-container *ngIf="counter2%2==1">
      ausblenden
    </ng-container>
  </button>

  <div *ngIf="termineEinblenden==true" id="terminContainer">

    <div id="ferienTermine" *ngIf="klassenplanServ.ferienListe$|async as ferien">
      Ferientermine
      <table class="dataTabelle">
        <tr>
          <td>Titel </td>
          <td>Termin </td>
          <td>Ende?</td>
        </tr>
        <tr *ngFor="let obj of ferien">
          <td><button triggers="click" [ngbTooltip]="Ferien2" [autoClose]="false"
              placement="bottom">{{obj.titel|unterstrichEntfernen}}</button> </td>
          <td> {{obj.start.toDate()|date:"d. M. YY"}} </td>
          <td *ngIf="obj.ende!==undefined">
            {{obj.ende.toDate()|date:"d. M. YY"}} </td>
          <ng-template #Ferien2>
            <div class="inputT">
              <div>Titel: <input type="text" #titel value="{{obj.titel}}"> </div>
              <div>Termin: <input type="text" #termin value="{{obj.start.toDate()|date:'d/M/Y'}}"> </div>
              <div>ende: <input type="text" #ende value="{{obj.ende?obj.ende.toDate():''|date:'d/M/Y'}}"> </div>
              <button (click)="ferienAdd(titel.value,termin.value,ende.value)">Ferientermin
                hinzufügen</button>
            </div>
          </ng-template>
        </tr>
        <button class="terminHinzufügen" triggers="click" [ngbTooltip]="Ferien" [autoClose]="false"
          placement="bottom">plusTermin</button>
        <ng-template #Ferien>
          <div class="inputT">
            <div>Titel: <input type="text" #titel> </div>
            <div>Termin: <input type="text" #termin> </div>
            <div>ende: <input type="text" #ende> </div>
            <button (click)="ferienAdd(titel.value,termin.value,ende.value)">Ferientermin
              hinzufügen</button>
          </div>
        </ng-template>
      </table>
    </div>

    <div id="pruefungsDaten" *ngIf="klassenplanServ.pruefungsListe$|async as pruefungen">
      Prüfungstermine
      <table class="dataTabelle">
        <tr>
          <td>Titel </td>
          <td>Termin </td>
          <td>Ende?</td>
        </tr>
        <tr *ngFor="let pruefung of pruefungen">
          <td><button triggers="click" [ngbTooltip]="Pruefung2" [autoClose]="false"
              placement="bottom">{{pruefung.titel|unterstrichEntfernen}}</button> </td>
          <td> {{pruefung.start.toDate()|date:"d. M. YY"}} </td>
          <td *ngIf="pruefung.ende!==undefined"> {{pruefung.ende.toDate()|date:"d. M. Y"}} </td>
          <ng-template #Pruefung2>
            <div class="inputT">
              <div>Titel: <input type="text" #titel value="{{pruefung.titel}}"> </div>
              <div>Start: <input type="text" #termin value="{{pruefung.start.toDate()|date:'d/M/Y'}}"> </div>
              <div>ende: <input type="text" #ende value="{{pruefung.ende?pruefung.ende.toDate():''|date:'d/M/Y'}}">
              </div>
              <button (click)="pruefungAdd(titel.value,termin.value,ende.value)">Prüfung
                hinzufügen</button>
            </div>
          </ng-template>
        </tr>
        <button class="terminHinzufügen" triggers="click" [ngbTooltip]="Pruefung" [autoClose]="false"
          placement="bottom">plusTermin</button>
        <ng-template #Pruefung>
          <div class="inputT">
            <div>Titel: <input type="text" #titel> </div>
            <div>Termin: <input type="text" #termin> </div>
            <div>ende: <input type="text" #ende> </div>
            <button (click)="pruefungAdd(titel.value,termin.value,ende.value)">Prüfung
              hinzufügen</button>
          </div>
        </ng-template>
      </table>
    </div>

    <div id="termineListe" *ngIf="klassenplanServ.terminListe$|async as termine">
      Klassen-Termine
      <table class="dataTabelle">
        <tr>
          <td>Titel </td>
          <td> Klasse </td>
          <td>Start </td>
          <td>Ende</td>
        </tr>
        <tr *ngFor="let termin of termine">

          <td><button triggers="click" [ngbTooltip]="Termin2" [autoClose]="false"
              placement="bottom">{{termin.titel|unterstrichEntfernen}}</button> </td>
          <td> {{termin.klasse}} </td>
          <td> {{termin.start.toDate()|date:"d. M."}} </td>
          <td>{{termin.ende.toDate()|date:"d. M. YY"}}</td>
          <ng-template #Termin2>
            <div class="inputT">
              <div>Titel: <input type="text" #titel value="{{termin.titel}}"> </div>
              <div>start: <input type="text" #start value="{{termin.start.toDate()|date:'d/M/Y'}}"> </div>
              <div>ende: <input type="text" #ende value="{{termin.ende.toDate()|date:'d/M/Y'}}"></div>
              <div>Klasse: <input type="text" #klasse value="{{termin.klasse}}"></div>
              <button (click)="terminAdd(titel.value,start.value,ende.value,klasse.value)">Termin
                hinzufügen</button>
            </div>
          </ng-template>
        </tr>
        <button class="terminHinzufügen" triggers="click" [ngbTooltip]="Termin" [autoClose]="false"
          placement="bottom">plusTermin</button>
        <ng-template #Termin>
          <div class="inputT">
            <div>Titel: <input type="text" #titel> </div>
            <div>start: <input type="text" #start> </div>
            <div>ende: <input type="text" #ende> </div>
            <div>Klasse: <input type="text" #klasse></div>
            <button (click)="terminAdd(titel.value,start.value,ende.value,klasse.value)">Termin
              hinzufügen</button>
          </div>
        </ng-template>

      </table>
    </div>

  </div>

  <h1 class="noprint {{gewaehlterPlan}}">

    <button (click)="abschnSub(absch)" style="background-color:inherit" width="40pt"> <img
        src="../../../assets/iconsNav/pfeilweißLinks.png" style="width:30pt"></button>

    <ng-container>
      <img *ngIf="absch==0" src="../../../assets/icons/sun.svg" width="40pt">
      <img *ngIf="absch==1" src="../../../assets/icons/leaf.svg" width="40pt">
      <img *ngIf="absch==2" src="../../../assets/icons/snowflake.svg" width="40pt">
      <img *ngIf="absch==3" src="../../../assets/icons/spriessen.svg" width="40pt">
    </ng-container>

    <button triggers="click" [autoClose]="true" [ngbTooltip]="esrPlaene" placement="bottom">
      {{gewaehlterPlan.toUpperCase()}}</button>



    <ng-template #esrPlaene>
      <button class="noprint rhyB" (click)="wahl('rhythmus')">Rhythmus</button>
      <button class="noprint epoB" (click)="wahl('epoche')">Epoche</button>
      <button class="noprint schB" (click)="wahl('schiene')">Schiene</button>
    </ng-template>

    <ng-container>
      <img *ngIf="absch==0" src="../../../assets/icons/leaf.svg" width="40pt">
      <img *ngIf="absch==1" src="../../../assets/icons/snowflake.svg" width="40pt">
      <img *ngIf="absch==2" src="../../../assets/icons/spriessen.svg" width="40pt">
      <img *ngIf="absch==3" src="../../../assets/icons/sun.svg" width="40pt">
    </ng-container>

    <button (click)="abschnAdd(absch)" style="background-color:inherit" width="40pt"> <img
        src="../../../assets/iconsNav/pfeilweißLinks.png" style="width:30pt;transform: rotate(180deg);;"></button>

  </h1>

  <div id="main" class="noprint">

    <ng-container *ngIf="esrPlan">
      <ng-container *ngFor="let abschnitt of esrPlan, index as ab">
        <div class="abschnittContainer">
          <div class="abschnitt" *ngIf="absch==ab">
            <ng-container *ngFor="let box of abschnitt, index as t">
              <div class="tagesContainer D{{box.tag.getDay()}}">
                <div class="Monat">
                  <ng-container *ngIf="box.tag.getDay()==1">
                    {{ferienServ.monatZuString( box.tag)}}
                  </ng-container>
                </div>
                <div class="Wochentag">
                  {{wochenTag(box.tag.getDay())}}
                </div>
                <!--an Datum toooltip ranbaun mit sondertag-INFO-->
                <div class="Datum {{besondererTag(box)}}">
                  {{box.tag|date: "d."}}
                </div>
                <div class="sonderBox">
                  <ng-container *ngIf="box.ferien.length>0">
                    <ng-container *ngFor="let fer of box.ferien">{{fer.titel|unterstrichEntfernen}}</ng-container>
                  </ng-container>
                  <ng-container *ngIf="box.pruefungen.length>0">
                    <ng-container *ngFor="let fer of box.pruefungen">{{fer.titel|unterstrichEntfernen}}</ng-container>
                  </ng-container>
                </div>

                <div class="buttonBox">
                  <div class="rhy" *ngIf="gewaehlterPlan==='rhythmus'">
                    <ng-container *ngIf="rhythmusElemente$|async as rhy">
                      <button triggers="click" class="B{{box.tag.getDay()}} " *ngIf="box.tag.getDay()==1"
                        [ngbTooltip]="FachAuswahl9" placement="bottom" [autoClose]="true"
                        (click)="clickN($event,9,  box.tag)">
                        <div class="neun" *ngIf="klassenFahrt(box.fahrten,9)!==null">
                          {{klassenFahrt(box.fahrten,9).titel}}
                        </div>
                        <ng-container *ngIf="klassenFahrt(box.fahrten,9)===null">
                          <div class="kuerzel">
                            <ng-container *ngFor="let ele of elementeDesTages(rhy.neun, box.tag, 'rhythmus')">
                              <span class="neun {{markedd(ele.lehrer[0].kuerzel)}}">
                                {{ele.lehrer[0].kuerzel}}
                              </span>
                            </ng-container>
                          </div>
                          <div class="fach">
                            <ng-container
                              *ngFor="let ele of elementeDesTages(rhy.neun, box.tag, 'rhythmus') as item; index as k">
                              <span class="neun {{markedd(ele.lehrer[0].kuerzel)}}"
                                *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                                {{ele.fach}}
                                (
                                <span
                                  *ngIf="(ele.rhythmus-reiheFachStunden(rhy.neun, ele.fach,ele.stundenGesamt,'rhythmus',ele.klasse))<0.5 , else ROT"                                  style="color:green;">
                                  {{reiheFachStunden(rhy.neun, ele.fach,ele.stundenGesamt,'rhythmus',ele.klasse)|number: '1.1-1'}}
                                </span>
                                <ng-template #ROT>
                                  <span style="color:red">
                                    {{reiheFachStunden(rhy.neun, ele.fach,ele.stundenGesamt,'rhythmus',ele.klasse)|number: '1.1-1'}}
                                  </span>
                                </ng-template>
                                |
                                {{ele.rhythmus}}
                                )
                              </span>
                            </ng-container>
                          </div>
                        </ng-container>

                        <!---->
                        <ng-template #FachAuswahl9>
                          <ng-container *ngIf="klassenplanServ.esrPlaan$|async as esrPlann">
                            <button *ngFor="let ele of esrPlann['rhythmus'][zahlInWort(9)]"
                              (click)="toggleClick(ele, box.tag)">
                              {{ele.lehrer[0]?.kuerzel}}({{ele?.fach}})
                            </button>
                          </ng-container>
                        </ng-template>
                        <!---->
                      </button>

                      <button triggers="click" class="B{{box.tag.getDay()}}" *ngIf="box.tag.getDay()==1"
                        [ngbTooltip]="FachAuswahl10" placement="bottom" [autoClose]="true"
                        (click)="clickN($event,10,  box.tag)">

                        <div class="zehn " *ngIf="klassenFahrt(box.fahrten,10)!==null">
                          {{klassenFahrt(box.fahrten,10).titel}}
                        </div>
                        <ng-container *ngIf="klassenFahrt(box.fahrten,10)===null">

                          <div class="kuerzel">
                            <ng-container *ngFor="let ele of elementeDesTages(rhy.zehn, box.tag, 'rhythmus')">
                              <span class="zehn {{markedd(ele.lehrer[0].kuerzel)}}">
                                {{ele.lehrer[0].kuerzel}}
                              </span>
                            </ng-container>
                          </div>
                          <div class="fach">
                            <ng-container
                              *ngFor="let ele of elementeDesTages(rhy.zehn, box.tag, 'rhythmus') as item; index as k">
                              <span class="zehn {{markedd(ele.lehrer[0].kuerzel)}}"
                                *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                                {{ele.fach}}
                                (
                                  <span
                                    *ngIf="(ele.rhythmus-reiheFachStunden(rhy.zehn, ele.fach,ele.stundenGesamt,'rhythmus',ele.klasse))<0.5 , else ROT"                                  style="color:green;">
                                    {{reiheFachStunden(rhy.zehn, ele.fach,ele.stundenGesamt,'rhythmus',ele.klasse)|number: '1.1-1'}}
                                  </span>
                                  <ng-template #ROT>
                                    <span style="color:red">
                                      {{reiheFachStunden(rhy.zehn, ele.fach,ele.stundenGesamt,'rhythmus',ele.klasse)|number: '1.1-1'}}
                                    </span>
                                  </ng-template>
                                  |
                                  {{ele.rhythmus}}
                                  )
                              </span>
                            </ng-container>
                          </div>

                        </ng-container>
                        <!---->
                        <ng-template #FachAuswahl10>
                          <ng-container *ngIf="klassenplanServ.esrPlaan$|async as esrPlann">
                            <button *ngFor="let ele of esrPlann['rhythmus'][zahlInWort(10)]"
                              (click)="toggleClick(ele, box.tag)">
                              {{ele.lehrer[0]?.kuerzel}}({{ele?.fach}})
                            </button>
                          </ng-container>
                        </ng-template>
                        <!---->
                      </button>

                      <button triggers="click" class="B{{box.tag.getDay()}}" *ngIf="box.tag.getDay()==1"
                        [ngbTooltip]="FachAuswahl11" placement="bottom" [autoClose]="true"
                        (click)="clickN($event,11,  box.tag)">
                        <div class="elf " *ngIf="klassenFahrt(box.fahrten,11)!==null">
                          {{klassenFahrt(box.fahrten,11).titel}}
                        </div>
                        <ng-container *ngIf="klassenFahrt(box.fahrten,11)===null">


                          <div class="kuerzel">
                            <ng-container *ngFor="let ele of elementeDesTages(rhy.elf, box.tag, 'rhythmus')">
                              <span class="elf {{markedd(ele.lehrer[0].kuerzel)}}">
                                {{ele.lehrer[0].kuerzel}}
                              </span>
                            </ng-container>
                          </div>
                          <div class="fach">
                            <ng-container
                              *ngFor="let ele of elementeDesTages(rhy.elf, box.tag, 'rhythmus') as item; index as k">
                              <span class="elf {{markedd(ele.lehrer[0].kuerzel)}}"
                                *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                                {{ele.fach}}
                                (
                                  <span
                                    *ngIf="(ele.rhythmus-reiheFachStunden(rhy.elf, ele.fach,ele.stundenGesamt,'rhythmus',ele.klasse))<0.5 , else ROT"                                  style="color:green;">
                                    {{reiheFachStunden(rhy.elf, ele.fach,ele.stundenGesamt,'rhythmus',ele.klasse)|number: '1.1-1'}}
                                  </span>
                                  <ng-template #ROT>
                                    <span style="color:red">
                                      {{reiheFachStunden(rhy.elf, ele.fach,ele.stundenGesamt,'rhythmus',ele.klasse)|number: '1.1-1'}}
                                    </span>
                                  </ng-template>
                                  |
                                  {{ele.rhythmus}}
                                  )
                              </span>
                            </ng-container>
                          </div>



                        </ng-container>
                        <!---->
                        <ng-template #FachAuswahl11>
                          <ng-container *ngIf="klassenplanServ.esrPlaan$|async as esrPlann">
                            <button *ngFor="let ele of esrPlann['rhythmus'][zahlInWort(11)]"
                              (click)="toggleClick(ele, box.tag)">
                              {{ele.lehrer[0]?.kuerzel}}({{ele?.fach}})
                            </button>
                          </ng-container>
                        </ng-template>
                        <!---->

                      </button>

                      <button triggers="click" class="B{{box.tag.getDay()}}" *ngIf="box.tag.getDay()==1"
                        [ngbTooltip]="FachAuswahl12" placement="bottom" [autoClose]="true"
                        (click)="clickN($event,12,  box.tag)">
                        <div class="zwoelf " *ngIf="klassenFahrt(box.fahrten,12)!==null">
                          {{klassenFahrt(box.fahrten,12).titel}}
                        </div>
                        <ng-container *ngIf="klassenFahrt(box.fahrten,12)===null">

                          <div class="kuerzel">
                            <ng-container *ngFor="let ele of elementeDesTages(rhy.zwoelf, box.tag, 'rhythmus')">
                              <span class="zwoelf {{markedd(ele.lehrer[0].kuerzel)}}">
                                {{ele.lehrer[0].kuerzel}}
                              </span>
                            </ng-container>
                          </div>
                          <div class="fach">
                            <ng-container
                              *ngFor="let ele of elementeDesTages(rhy.zwoelf, box.tag, 'rhythmus') as item; index as k">
                              <span class="zwoelf {{markedd(ele.lehrer[0].kuerzel)}}"
                                *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                                {{ele.fach}}
                                (
                                  <span
                                    *ngIf="(ele.rhythmus-reiheFachStunden(rhy.zwoelf, ele.fach,ele.stundenGesamt,'rhythmus',ele.klasse))<0.1 , else ROT"                                  style="color:green;">
                                    {{reiheFachStunden(rhy.zwoelf, ele.fach,ele.stundenGesamt,'rhythmus',ele.klasse)|number: '1.1-1'}}
                                  </span>
                                  <ng-template #ROT>
                                    <span style="color:red">
                                      {{reiheFachStunden(rhy.zwoelf, ele.fach,ele.stundenGesamt,'rhythmus',ele.klasse)|number: '1.1-1'}}
                                    </span>
                                  </ng-template>
                                  |
                                  {{ele.rhythmus}}
                                  )
                              </span>
                            </ng-container>
                          </div>

                        </ng-container>
                        <!---->
                        <ng-template #FachAuswahl12>
                          <ng-container *ngIf="klassenplanServ.esrPlaan$|async as esrPlann">
                            <button *ngFor="let ele of esrPlann['rhythmus'][zahlInWort(12)]"
                              (click)="toggleClick(ele, box.tag)">
                              {{ele.lehrer[0]?.kuerzel}}({{ele?.fach}})
                            </button>
                          </ng-container>
                        </ng-template>
                        <!---->
                      </button>
                    </ng-container>
                  </div>




                  <div class="epo" *ngIf="gewaehlterPlan==='epoche'">
                    <ng-container *ngIf="epochenElemente$|async as epo">

                      <button triggers="click" class="B{{box.tag.getDay()}}" *ngIf="box.tag.getDay()==1"
                        [ngbTooltip]="FachAuswahl9" placement="bottom" [autoClose]="true"
                        (click)="clickN($event,9,  box.tag)">



                        <div class="neun " *ngIf="klassenFahrt(box.fahrten,9)!==null">
                          {{klassenFahrt(box.fahrten,9).titel}}
                        </div>
                        <ng-container *ngIf="klassenFahrt(box.fahrten,9)===null">

                          <div class="kuerzel">
                            <ng-container *ngFor="let ele of elementeDesTages(epo.neun, box.tag, 'epoche')">
                              <span class="neun {{markedd(ele.lehrer[0].kuerzel)}}">
                                {{ele.lehrer[0].kuerzel}}
                              </span>
                            </ng-container>
                          </div>
                          <div class="fach">
                            <ng-container
                              *ngFor="let ele of elementeDesTages(epo.neun, box.tag, 'epoche') as item; index as k">
                              <span class="neun {{markedd(ele.lehrer[0].kuerzel)}}"
                                *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                                {{ele.fach}}
                                (   
                                  <span
                                    *ngIf="(ele.epoche-reiheFachStunden(epo.neun, ele.fach,ele.stundenGesamt,'epoche',ele.klasse))<0.5 , else ROT"                                  style="color:green;">
                                    {{reiheFachStunden(epo.neun, ele.fach,ele.stundenGesamt,'epoche',ele.klasse)|number: '1.1-1'}}
                                  </span>
                                  <ng-template #ROT>
                                    <span style="color:red">
                                      {{reiheFachStunden(epo.neun, ele.fach,ele.stundenGesamt,'epoche',ele.klasse)|number: '1.1-1'}}
                                    </span>
                                  </ng-template>
                                  |
                                  {{ele.epoche}}
                                  )
                              </span>
                            </ng-container>
                          </div>


                        </ng-container>




                        <!---->
                        <ng-template #FachAuswahl9>
                          <ng-container *ngIf="klassenplanServ.esrPlaan$|async as esrPlann">
                            <button *ngFor="let ele of esrPlann['epoche'][zahlInWort(9)]"
                              (click)="toggleClick(ele, box.tag)">
                              {{ele.lehrer[0]?.kuerzel}}({{ele?.fach}})
                              {{ele['epoche']}}|{{ele.zuweisung['epoche'].length}}
                            </button>
                          </ng-container>
                        </ng-template>
                        <!---->
                      </button>

                      <button triggers="click" class="B{{box.tag.getDay()}}" *ngIf="box.tag.getDay()==1"
                        [ngbTooltip]="FachAuswahl10" placement="bottom" [autoClose]="true"
                        (click)="clickN($event,10,  box.tag)">

                        <div class="zehn" *ngIf="klassenFahrt(box.fahrten,10)!==null">
                          {{klassenFahrt(box.fahrten,10).titel}}
                        </div>
                        <ng-container *ngIf="klassenFahrt(box.fahrten,10)===null">

                          <div class="kuerzel">
                            <ng-container *ngFor="let ele of elementeDesTages(epo.zehn, box.tag, 'epoche')">
                              <span class="zehn {{markedd(ele.lehrer[0].kuerzel)}}">
                                {{ele.lehrer[0].kuerzel}}
                              </span>
                            </ng-container>
                          </div>
                          <div class="fach">
                            <ng-container
                              *ngFor="let ele of elementeDesTages(epo.zehn, box.tag, 'epoche') as item; index as k">
                              <span class="zehn {{markedd(ele.lehrer[0].kuerzel)}}"
                                *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                                {{ele.fach}}
                                (   
                                  <span
                                    *ngIf="(ele.epoche-reiheFachStunden(epo.zehn, ele.fach,ele.stundenGesamt,'epoche',ele.klasse))<0.5 , else ROT"                                  style="color:green;">
                                    {{reiheFachStunden(epo.zehn, ele.fach,ele.stundenGesamt,'epoche',ele.klasse)|number: '1.1-1'}}
                                  </span>
                                  <ng-template #ROT>
                                    <span style="color:red">
                                      {{reiheFachStunden(epo.zehn, ele.fach,ele.stundenGesamt,'epoche',ele.klasse)|number: '1.1-1'}}
                                    </span>
                                  </ng-template>
                                  |
                                  {{ele.epoche}}
                                  )
                              </span>
                            </ng-container>
                          </div>

                        </ng-container>
                        <!---->
                        <ng-template #FachAuswahl10>
                          <ng-container *ngIf="klassenplanServ.esrPlaan$|async as esrPlann">
                            <button *ngFor="let ele of esrPlann['epoche'][zahlInWort(10)]"
                              (click)="toggleClick(ele, box.tag)">
                              {{ele.lehrer[0]?.kuerzel}}({{ele?.fach}})
                              {{ele['epoche']}}|{{ele.zuweisung['epoche'].length}}
                            </button>
                          </ng-container>
                        </ng-template>
                        <!---->
                      </button>

                      <button triggers="click" class="B{{box.tag.getDay()}}" *ngIf="box.tag.getDay()==1"
                        [ngbTooltip]="FachAuswahl11" placement="bottom" [autoClose]="true"
                        (click)="clickN($event,11,  box.tag)">
                        <div class="elf" *ngIf="klassenFahrt(box.fahrten,11)!==null">
                          {{klassenFahrt(box.fahrten,11).titel}}
                        </div>
                        <ng-container *ngIf="klassenFahrt(box.fahrten,11)===null">

                          <div class="kuerzel">
                            <ng-container *ngFor="let ele of elementeDesTages(epo.elf, box.tag, 'epoche')">
                              <span class="elf {{markedd(ele.lehrer[0].kuerzel)}}">
                                {{ele.lehrer[0].kuerzel}}
                              </span>
                            </ng-container>
                          </div>
                          <div class="fach">
                            <ng-container
                              *ngFor="let ele of elementeDesTages(epo.elf, box.tag, 'epoche') as item; index as k">
                              <span class="elf {{markedd(ele.lehrer[0].kuerzel)}}"
                                *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                                {{ele.fach}}
                                (   
                                  <span
                                    *ngIf="(ele.epoche-reiheFachStunden(epo.elf, ele.fach,ele.stundenGesamt,'epoche',ele.klasse))<0.5 , else ROT"                                  style="color:green;">
                                    {{reiheFachStunden(epo.elf, ele.fach,ele.stundenGesamt,'epoche',ele.klasse)|number: '1.1-1'}}
                                  </span>
                                  <ng-template #ROT>
                                    <span style="color:red">
                                      {{reiheFachStunden(epo.elf, ele.fach,ele.stundenGesamt,'epoche',ele.klasse)|number: '1.1-1'}}
                                    </span>
                                  </ng-template>
                                  |
                                  {{ele.epoche}}
                                  )
                              </span>
                            </ng-container>
                          </div>

                        </ng-container>
                        <!---->
                        <ng-template #FachAuswahl11>
                          <ng-container *ngIf="klassenplanServ.esrPlaan$|async as esrPlann">
                            <button *ngFor="let ele of esrPlann['epoche'][zahlInWort(11)]"
                              (click)="toggleClick(ele, box.tag)">
                              {{ele.lehrer[0]?.kuerzel}}({{ele?.fach}})
                              {{ele['epoche']}}|{{ele.zuweisung['epoche'].length}}
                            </button>
                          </ng-container>
                        </ng-template>
                        <!---->

                      </button>

                      <button triggers="click" class="B{{box.tag.getDay()}}" *ngIf="box.tag.getDay()==1"
                        [ngbTooltip]="FachAuswahl12" placement="bottom" [autoClose]="true"
                        (click)="clickN($event,12,  box.tag)">
                        <div class="zwoelf" *ngIf="klassenFahrt(box.fahrten,12)!==null">
                          {{klassenFahrt(box.fahrten,12).titel}}
                        </div>
                        <ng-container *ngIf="klassenFahrt(box.fahrten,12)===null">

                          <div class="kuerzel">
                            <ng-container *ngFor="let ele of elementeDesTages(epo.zwoelf, box.tag, 'epoche')">
                              <span class="zwoelf {{markedd(ele.lehrer[0].kuerzel)}}">
                                {{ele.lehrer[0].kuerzel}}
                              </span>
                            </ng-container>
                          </div>
                          <div class="fach">
                            <ng-container
                              *ngFor="let ele of elementeDesTages(epo.zwoelf, box.tag, 'epoche') as item; index as k">
                              <span class="zwoelf {{markedd(ele.lehrer[0].kuerzel)}}"
                                *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                                {{ele.fach}}
                                (   
                                  <span
                                    *ngIf="(ele.epoche-reiheFachStunden(epo.zwoelf, ele.fach,ele.stundenGesamt,'epoche',ele.klasse))<0.5 , else ROT"                                  style="color:green;">
                                    {{reiheFachStunden(epo.zwoelf, ele.fach,ele.stundenGesamt,'epoche',ele.klasse)|number: '1.1-1'}}
                                  </span>
                                  <ng-template #ROT>
                                    <span style="color:red">
                                      {{reiheFachStunden(epo.zwoelf, ele.fach,ele.stundenGesamt,'epoche',ele.klasse)|number: '1.1-1'}}
                                    </span>
                                  </ng-template>
                                  |
                                  {{ele.epoche}}
                                  )
                              </span>
                            </ng-container>
                          </div>

                        </ng-container>
                        <!---->
                        <ng-template #FachAuswahl12>
                          <ng-container *ngIf="klassenplanServ.esrPlaan$|async as esrPlann">
                            <button *ngFor="let ele of esrPlann['epoche'][zahlInWort(12)]"
                              (click)="toggleClick(ele, box.tag)">
                              {{ele.lehrer[0]?.kuerzel}}({{ele?.fach}})
                              {{ele['epoche']}}|{{ele.zuweisung['epoche'].length}}
                            </button>
                          </ng-container>
                        </ng-template>
                        <!---->
                      </button>
                    </ng-container>

                  </div>

                  <div class="sch" *ngIf="gewaehlterPlan==='schiene'">
                    <ng-container *ngIf="schieneElemente$|async as sch">

                      <button triggers="click" class="B{{box.tag.getDay()}}" *ngIf="box.tag.getDay()==1"
                        [ngbTooltip]="FachAuswahl9" placement="bottom" [autoClose]="true"
                        (click)="clickN($event,9,  box.tag)">



                        <div class="neun" *ngIf="klassenFahrt(box.fahrten,9)!==null">
                          {{klassenFahrt(box.fahrten,9).titel}}
                        </div>

                        <ng-container *ngIf="klassenFahrt(box.fahrten,9)===null">



                          <div class="kuerzel">
                            <ng-container *ngFor="let ele of elementeDesTages(sch.neun, box.tag, 'schiene')">
                              <span class="neun {{markedd(ele.lehrer[0].kuerzel)}}">
                                {{ele.lehrer[0].kuerzel}}
                              </span>
                            </ng-container>
                          </div>
                          <div class="fach">
                            <ng-container
                              *ngFor="let ele of elementeDesTages(sch.neun, box.tag, 'schiene') as item; index as k">
                              <span class="neun {{markedd(ele.lehrer[0].kuerzel)}}"
                                *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                                {{ele.fach}}
                                (   
                                  <span
                                    *ngIf="(ele.schiene-reiheFachStunden(sch.neun, ele.fach,ele.stundenGesamt,'schiene',ele.klasse))<0.5 , else ROT"                                  style="color:green;">
                                    {{reiheFachStunden(sch.neun, ele.fach,ele.stundenGesamt,'schiene',ele.klasse)|number: '1.1-1'}}
                                  </span>
                                  <ng-template #ROT>
                                    <span style="color:red">
                                      {{reiheFachStunden(sch.neun, ele.fach,ele.stundenGesamt,'schiene',ele.klasse)|number: '1.1-1'}}
                                    </span>
                                  </ng-template>
                                  |
                                  {{ele.schiene}}
                                  )
                              </span>
                            </ng-container>
                          </div>



                        </ng-container>


                        <!---->
                        <ng-template #FachAuswahl9>
                          <ng-container *ngIf="klassenplanServ.esrPlaan$|async as esrPlann">
                            <button *ngFor="let ele of esrPlann['schiene'][zahlInWort(9)]"
                              (click)="toggleClick(ele, box.tag)">
                              {{ele.lehrer[0]?.kuerzel}}({{ele?.fach}})
                              {{ele['schiene']}}|{{ele.zuweisung['schiene'].length}}
                            </button>
                          </ng-container>
                        </ng-template>
                        <!---->
                      </button>

                      <button triggers="click" class="B{{box.tag.getDay()}}" *ngIf="box.tag.getDay()==1"
                        [ngbTooltip]="FachAuswahl10" placement="bottom" [autoClose]="true"
                        (click)="clickN($event,10,  box.tag)">

                        <div class="zehn" *ngIf="klassenFahrt(box.fahrten,10)!==null">
                          {{klassenFahrt(box.fahrten,10).titel}}
                        </div>
                        <ng-container *ngIf="klassenFahrt(box.fahrten,10)===null">


                          <div class="kuerzel">
                            <ng-container *ngFor="let ele of elementeDesTages(sch.zehn, box.tag, 'schiene')">
                              <span class="zehn {{markedd(ele.lehrer[0].kuerzel)}}">
                                {{ele.lehrer[0].kuerzel}}
                              </span>
                            </ng-container>
                          </div>
                          <div class="fach">
                            <ng-container
                              *ngFor="let ele of elementeDesTages(sch.zehn, box.tag, 'schiene') as item; index as k">
                              <span class="zehn {{markedd(ele.lehrer[0].kuerzel)}}"
                                *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                                {{ele.fach}}
                                (   
                                  <span
                                    *ngIf="(ele.schiene-reiheFachStunden(sch.zehn, ele.fach,ele.stundenGesamt,'schiene',ele.klasse))<0.5 , else ROT"                                  style="color:green;">
                                    {{reiheFachStunden(sch.zehn, ele.fach,ele.stundenGesamt,'schiene',ele.klasse)|number: '1.1-1'}}
                                  </span>
                                  <ng-template #ROT>
                                    <span style="color:red">
                                      {{reiheFachStunden(sch.zehn, ele.fach,ele.stundenGesamt,'schiene',ele.klasse)|number: '1.1-1'}}
                                    </span>
                                  </ng-template>
                                  |
                                  {{ele.schiene}}
                                  )
                              </span>
                            </ng-container>
                          </div>


                        </ng-container>
                        <!---->
                        <ng-template #FachAuswahl10>
                          <ng-container *ngIf="klassenplanServ.esrPlaan$|async as esrPlann">
                            <button *ngFor="let ele of esrPlann['schiene'][zahlInWort(10)]"
                              (click)="toggleClick(ele, box.tag)">
                              {{ele.lehrer[0]?.kuerzel}}({{ele?.fach}})
                              {{ele['schiene']}}|{{ele.zuweisung['schiene'].length}}
                            </button>
                          </ng-container>
                        </ng-template>
                        <!---->
                      </button>

                      <button triggers="click" class="B{{box.tag.getDay()}}" *ngIf="box.tag.getDay()==1"
                        [ngbTooltip]="FachAuswahl11" placement="bottom" [autoClose]="true"
                        (click)="clickN($event,11,  box.tag)">
                        <div class="elf" *ngIf="klassenFahrt(box.fahrten,11)!==null">
                          {{klassenFahrt(box.fahrten,11).titel}}
                        </div>
                        <ng-container *ngIf="klassenFahrt(box.fahrten,11)===null">

                          <div class="kuerzel">
                            <ng-container *ngFor="let ele of elementeDesTages(sch.elf, box.tag, 'schiene')">
                              <span class="elf {{markedd(ele.lehrer[0].kuerzel)}}">
                                {{ele.lehrer[0].kuerzel}}
                              </span>
                            </ng-container>
                          </div>
                          <div class="fach">
                            <ng-container
                              *ngFor="let ele of elementeDesTages(sch.elf, box.tag, 'schiene') as item; index as k">
                              <span class="elf {{markedd(ele.lehrer[0].kuerzel)}}"
                                *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                                {{ele.fach}}
                                (   
                                  <span
                                    *ngIf="(ele.schiene-reiheFachStunden(sch.elf, ele.fach,ele.stundenGesamt,'schiene',ele.klasse))<0.5 , else ROT"                                  style="color:green;">
                                    {{reiheFachStunden(sch.elf, ele.fach,ele.stundenGesamt,'schiene',ele.klasse)|number: '1.1-1'}}
                                  </span>
                                  <ng-template #ROT>
                                    <span style="color:red">
                                      {{reiheFachStunden(sch.elf, ele.fach,ele.stundenGesamt,'schiene',ele.klasse)|number: '1.1-1'}}
                                    </span>
                                  </ng-template>
                                  |
                                  {{ele.schiene}}
                                  )
                              </span>
                            </ng-container>
                          </div>



                        </ng-container>
                        <!---->
                        <ng-template #FachAuswahl11>
                          <ng-container *ngIf="klassenplanServ.esrPlaan$|async as esrPlann">
                            <button *ngFor="let ele of esrPlann['schiene'][zahlInWort(11)]"
                              (click)="toggleClick(ele, box.tag)">
                              {{ele.lehrer[0]?.kuerzel}}({{ele?.fach}})
                              {{ele['schiene']}}|{{ele.zuweisung['schiene'].length}}
                            </button>
                          </ng-container>
                        </ng-template>
                        <!---->

                      </button>

                      <button triggers="click" class="B{{box.tag.getDay()}}" *ngIf="box.tag.getDay()==1"
                        [ngbTooltip]="FachAuswahl12" placement="bottom" [autoClose]="true"
                        (click)="clickN($event,12,  box.tag)">
                        <div class="zwoelf" *ngIf="klassenFahrt(box.fahrten,12)!==null">
                          {{klassenFahrt(box.fahrten,12).titel}}
                        </div>
                        <ng-container *ngIf="klassenFahrt(box.fahrten,12)===null">


                          <div class="kuerzel">
                            <ng-container *ngFor="let ele of elementeDesTages(sch.zwoelf, box.tag, 'schiene')">
                              <span class="zwoelf {{markedd(ele.lehrer[0].kuerzel)}}">
                                {{ele.lehrer[0].kuerzel}}
                              </span>
                            </ng-container>
                          </div>
                          <div class="fach">
                            <ng-container
                              *ngFor="let ele of elementeDesTages(sch.zwoelf, box.tag, 'schiene') as item; index as k">
                              <span class="zwoelf {{markedd(ele.lehrer[0].kuerzel)}}"
                                *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                                {{ele.fach}}
                                (   
                                  <span
                                    *ngIf="(ele.schiene-reiheFachStunden(sch.zwoelf, ele.fach,ele.stundenGesamt,'schiene',ele.klasse))<0.5 , else ROT"                                  style="color:green;">
                                    {{reiheFachStunden(sch.zwoelf, ele.fach,ele.stundenGesamt,'schiene',ele.klasse)|number: '1.1-1'}}
                                  </span>
                                  <ng-template #ROT>
                                    <span style="color:red">
                                      {{reiheFachStunden(sch.zwoelf, ele.fach,ele.stundenGesamt,'schiene',ele.klasse)|number: '1.1-1'}}
                                    </span>
                                  </ng-template>
                                  |
                                  {{ele.schiene}}
                                  )
                              </span>
                            </ng-container>
                          </div>



                        </ng-container>
                        <!---->
                        <ng-template #FachAuswahl12>
                          <ng-container *ngIf="klassenplanServ.esrPlaan$|async as esrPlann">
                            <button *ngFor="let ele of esrPlann['schiene'][zahlInWort(12)]"
                              (click)="toggleClick(ele, box.tag)">
                              {{ele.lehrer[0]?.kuerzel}}({{ele?.fach}})
                              {{ele['schiene']}}|{{ele.zuweisung['schiene'].length}}
                            </button>
                          </ng-container>
                        </ng-template>
                        <!---->
                      </button>
                    </ng-container>

                  </div>
                </div>

              </div>
            </ng-container>
          </div>
        </div>
      </ng-container>


    </ng-container>

  </div>












  <!-- COPY PRINT -->

  <div id="printContain" *ngIf="printAktiv">
    <ng-container *ngIf="esrPlan">
      <ng-container *ngFor="let abschnitt of esrPlan, index as ab">
        <div>
          <table>
            <tr>
              <ng-container *ngFor="let box of abschnitt, index as t">
                <ng-container *ngIf="box.tag.getDay()==1">
                  <td colSpan="1">
                    <div>
                      <ng-container>
                        <ng-container *ngIf="t<7|| box.tag.getMonth()!==abschnitt[t-7].tag.getMonth()">
                          {{ferienServ.monatZuString( box.tag)}}
                        </ng-container>
                      </ng-container>
                    </div>
                    <div class="klein">
                      {{wochenTag(box.tag.getDay())}}
                      <span class="klein {{besondererTag(box)}}">{{box.tag|date: "d."}} </span>
                      <ng-container *ngIf="abschnitt.length>t+1">
                        <span *ngIf="besondererTag(abschnitt[t+1]).length>0"
                          class="klein {{besondererTag(abschnitt[t+1])}}">{{abschnitt[t+1].tag|date: "d."}}
                        </span>
                      </ng-container>
                      <ng-container *ngIf="abschnitt.length>t+2">
                        <span *ngIf="besondererTag(abschnitt[t+2]).length>0"
                          class="klein {{besondererTag(abschnitt[t+2])}}">{{abschnitt[t+2].tag|date: "d."}}
                        </span>
                      </ng-container>
                      <ng-container *ngIf="abschnitt.length>t+3">
                        <span *ngIf="besondererTag(abschnitt[t+3]).length>0"
                          class="klein {{besondererTag(abschnitt[t+3])}}">{{abschnitt[t+3].tag|date: "d."}}
                        </span>
                      </ng-container>
                      <ng-container *ngIf="abschnitt.length>t+4">
                        <span *ngIf="besondererTag(abschnitt[t+4]).length>0"
                          class="klein {{besondererTag(abschnitt[t+4])}}">{{abschnitt[t+4].tag|date: "d."}}
                        </span>
                      </ng-container>
                    </div>
                    <!-- <div class="sonderBox">
                      <ng-container *ngIf="box.ferien.length>0">
                        <ng-container *ngFor="let fer of box.ferien">{{fer.titel|unterstrichEntfernen}}</ng-container>
                      </ng-container>
                      <ng-container *ngIf="box.pruefungen.length>0">
                        <ng-container *ngFor="let fer of box.pruefungen">{{fer.titel|unterstrichEntfernen}}
                        </ng-container>
                      </ng-container>
                    </div>-->
                  </td>
                </ng-container>
              </ng-container>
            </tr>


            <tr class="rhythmus" *ngIf="rhythmusElemente$|async as rhy">
              <ng-container *ngFor="let box of abschnitt, index as t">
                <ng-container *ngIf="box.tag.getDay()==1">
                  <ng-container class="neun" *ngIf="klassenFahrt(box.fahrten,9)!==null">
                    <ng-container
                      *ngIf="t<7||(t>=7&&klassenFahrt(abschnitt[t-7].fahrten,9)===null)||(t>=7&&klassenFahrt(abschnitt[t].fahrten,9).titel!==klassenFahrt(abschnitt[t-7].fahrten,9).titel)">
                      <td class="fahrt" colSpan="{{klassenFahrtBreite(abschnitt,box,9,t)}}">
                        {{kuerzen(klassenFahrt(box.fahrten,9).titel)}}
                      </td>
                    </ng-container>
                  </ng-container>
                  <ng-container *ngIf="klassenFahrt(box.fahrten,9)===null">
                    <ng-container
                      *ngIf="t<6||(t>6&&breite(rhy.neun,abschnitt[t].tag,t, 'rhythmus',abschnitt)>=breite(rhy.neun,abschnitt[t-7].tag,t,'rhythmus',abschnitt))">
                      <td colSpan="{{breite(rhy.neun,abschnitt[t].tag,t, 'rhythmus', abschnitt)}}">
                        <!--        {{breite(rhy.neun,box.tag,t, 'rhythmus',abschnitt)}}-->

                        <div class="kuerzel">
                          <ng-container *ngFor="let ele of elementeDesTages(rhy.neun, box.tag, 'rhythmus')">
                            <span class="neun {{markedd(ele.lehrer[0].kuerzel)}}">
                              {{ele.lehrer[0].kuerzel}}
                            </span>
                          </ng-container>
                        </div>
                        <div class="fach">
                          <ng-container
                            *ngFor="let ele of elementeDesTages(rhy.neun, box.tag, 'rhythmus') as item; index as k">
                            <span class="neun {{markedd(ele.lehrer[0].kuerzel)}}"
                              *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                              {{ele.fach}}
                            </span>
                          </ng-container>
                        </div>




                      </td>
                    </ng-container>

                  </ng-container>
                </ng-container>
              </ng-container>
            </tr>



            <tr class="rhythmus" *ngIf="rhythmusElemente$|async as rhy">
              <ng-container *ngFor="let box of abschnitt, index as t">
                <ng-container *ngIf="box.tag.getDay()==1">
                  <ng-container class="zehn " *ngIf="klassenFahrt(box.fahrten,10)!==null">
                    <ng-container
                      *ngIf="t<7||(t>=7&&klassenFahrt(abschnitt[t-7].fahrten,10)===null)||(t>=7&&klassenFahrt(abschnitt[t].fahrten,10).titel!==klassenFahrt(abschnitt[t-7].fahrten,10).titel)">
                      <td class="fahrt" colSpan="{{klassenFahrtBreite(abschnitt,box,10,t)}}">
                        {{kuerzen(klassenFahrt(box.fahrten,10).titel)}}
                      </td>
                    </ng-container>
                  </ng-container>
                  <ng-container *ngIf="klassenFahrt(box.fahrten,10)===null">
                    <ng-container
                      *ngIf="t<6||(t>6&&breite(rhy.zehn,abschnitt[t].tag,t, 'rhythmus',abschnitt)>=breite(rhy.zehn,abschnitt[t-7].tag,t,'rhythmus',abschnitt))">
                      <td colSpan="{{breite(rhy.zehn,abschnitt[t].tag,t, 'rhythmus', abschnitt)}}">

                        <!--          {{breite(rhy.zehn,box.tag,t, 'rhythmus',abschnitt)}}-->
                        <div class="kuerzel">
                          <ng-container *ngFor="let ele of elementeDesTages(rhy.zehn, box.tag, 'rhythmus')">
                            <span class="zehn {{markedd(ele.lehrer[0].kuerzel)}}">
                              {{ele.lehrer[0].kuerzel}}
                            </span>
                          </ng-container>
                        </div>
                        <div class="fach">
                          <ng-container
                            *ngFor="let ele of elementeDesTages(rhy.zehn, box.tag, 'rhythmus') as item; index as k">
                            <span class="zehn {{markedd(ele.lehrer[0].kuerzel)}}"
                              *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                              {{ele.fach}}
                            </span>
                          </ng-container>
                        </div>
                      </td>
                    </ng-container>

                  </ng-container>
                </ng-container>
              </ng-container>
            </tr>

            <tr class="rhythmus" *ngIf="rhythmusElemente$|async as rhy">
              <ng-container *ngFor="let box of abschnitt, index as t">
                <ng-container *ngIf="box.tag.getDay()==1">
                  <ng-container class="elf " *ngIf="klassenFahrt(box.fahrten,11)!==null">
                    <ng-container
                      *ngIf="t<7||(t>=7&&klassenFahrt(abschnitt[t-7].fahrten,11)===null)||(t>=7&&klassenFahrt(abschnitt[t].fahrten,11).titel!==klassenFahrt(abschnitt[t-7].fahrten,11).titel)">
                      <td class="fahrt" colSpan="{{klassenFahrtBreite(abschnitt,box,11,t)}}">
                        {{kuerzen(klassenFahrt(box.fahrten,11).titel)}}
                      </td>
                    </ng-container>
                  </ng-container>
                  <ng-container *ngIf="klassenFahrt(box.fahrten,11)===null">
                    <ng-container
                      *ngIf="t<6||(t>6&&breite(rhy.elf,abschnitt[t].tag,t, 'rhythmus',abschnitt)>=breite(rhy.elf,abschnitt[t-7].tag,t,'rhythmus',abschnitt))">
                      <td colSpan="{{breite(rhy.elf,abschnitt[t].tag,t, 'rhythmus', abschnitt)}}">
                        <!--          {{breite(rhy.elf,abschnitt[t].tag,t, 'rhythmus', abschnitt)}}-->
                        <div class="kuerzel">
                          <ng-container *ngFor="let ele of elementeDesTages(rhy.elf, box.tag, 'rhythmus')">
                            <span class="elf {{markedd(ele.lehrer[0].kuerzel)}}">
                              {{ele.lehrer[0].kuerzel}}
                            </span>
                          </ng-container>
                        </div>
                        <div class="fach">
                          <ng-container
                            *ngFor="let ele of elementeDesTages(rhy.elf, box.tag, 'rhythmus') as item; index as k">
                            <span class="elf {{markedd(ele.lehrer[0].kuerzel)}}"
                              *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                              {{ele.fach}}
                            </span>
                          </ng-container>
                        </div>
                      </td>
                    </ng-container>

                  </ng-container>
                </ng-container>
              </ng-container>
            </tr>
            <tr class="rhythmus" *ngIf="rhythmusElemente$|async as rhy">
              <ng-container *ngFor="let box of abschnitt, index as t">
                <ng-container *ngIf="box.tag.getDay()==1">

                  <ng-container class="zwoelf " *ngIf="klassenFahrt(box.fahrten,12)!==null">
                    <ng-container
                      *ngIf="t<7||(t>=7&&klassenFahrt(abschnitt[t-7].fahrten,12)===null)||(t>=7&&klassenFahrt(abschnitt[t].fahrten,12).titel!==klassenFahrt(abschnitt[t-7].fahrten,12).titel)">
                      <td class="fahrt" colSpan="{{klassenFahrtBreite(abschnitt,box,12,t)}}">
                        {{kuerzen(klassenFahrt(box.fahrten,12).titel)}}
                      </td>
                    </ng-container>
                  </ng-container>
                  <ng-container *ngIf="klassenFahrt(box.fahrten,12)===null">
                    <ng-container
                      *ngIf="t<6||(t>6&&breite(rhy.zwoelf,abschnitt[t].tag,t, 'rhythmus',abschnitt)>=breite(rhy.zwoelf,abschnitt[t-7].tag,t,'rhythmus',abschnitt))">
                      <td colSpan="{{breite(rhy.zwoelf,abschnitt[t].tag,t, 'rhythmus', abschnitt)}}">
                        <!--          {{breite(rhy.zwoelf,abschnitt[t].tag,t, 'rhythmus', abschnitt)}}-->
                        <div class="kuerzel">
                          <ng-container *ngFor="let ele of elementeDesTages(rhy.zwoelf, box.tag, 'rhythmus')">
                            <span class="zwoelf {{markedd(ele.lehrer[0].kuerzel)}}">
                              {{ele.lehrer[0].kuerzel}}
                            </span>
                          </ng-container>
                        </div>
                        <div class="fach">
                          <ng-container
                            *ngFor="let ele of elementeDesTages(rhy.zwoelf, box.tag, 'rhythmus') as item; index as k">
                            <span class="zwoelf {{markedd(ele.lehrer[0].kuerzel)}}"
                              *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                              {{ele.fach}}
                            </span>
                          </ng-container>
                        </div>
                      </td>
                    </ng-container>

                  </ng-container>
                </ng-container>
              </ng-container>
            </tr>
            <tr>

            </tr>
            <tr class="epoche" *ngIf="epochenElemente$|async as epo">
              <ng-container *ngFor="let box of abschnitt, index as t">
                <ng-container *ngIf="box.tag.getDay()==1">
                  <ng-container class="neun " *ngIf="klassenFahrt(box.fahrten,9)!==null">
                    <ng-container
                      *ngIf="t<7||(t>=7&&klassenFahrt(abschnitt[t-7].fahrten,9)===null)||(t>=7&&klassenFahrt(abschnitt[t].fahrten,9).titel!==klassenFahrt(abschnitt[t-7].fahrten,9).titel)">
                      <td class="fahrt" colSpan="{{klassenFahrtBreite(abschnitt,box,9,t)}}">

                        {{kuerzen(klassenFahrt(box.fahrten,9).titel)}}
                      </td>
                    </ng-container>
                  </ng-container>
                  <ng-container *ngIf="klassenFahrt(box.fahrten,9)===null">
                    <ng-container
                      *ngIf="t<6||(t>6&&breite(epo.neun,abschnitt[t].tag,t, 'epoche',abschnitt)>=breite(epo.neun,abschnitt[t-7].tag,t,'epoche',abschnitt))">
                      <td colSpan="{{breite(epo.neun,abschnitt[t].tag,t, 'epoche', abschnitt)}}">
                        <!--         {{breite(epo.neun,abschnitt[t].tag,t, 'epoche', abschnitt)}}-->
                        <div class="kuerzel">
                          <ng-container *ngFor="let ele of elementeDesTages(epo.neun, box.tag, 'epoche')">
                            <span class="neun {{markedd(ele.lehrer[0].kuerzel)}}">
                              {{ele.lehrer[0].kuerzel}}
                            </span>
                          </ng-container>
                        </div>
                        <div class="fach">
                          <ng-container
                            *ngFor="let ele of elementeDesTages(epo.neun, box.tag, 'epoche') as item; index as k">
                            <span class="neun {{markedd(ele.lehrer[0].kuerzel)}}"
                              *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                              {{ele.fach}}
                            </span>
                          </ng-container>
                        </div>
                      </td>
                    </ng-container>

                  </ng-container>
                </ng-container>
              </ng-container>
            </tr>



            <tr class="epoche" *ngIf="epochenElemente$|async as epo">
              <ng-container *ngFor="let box of abschnitt, index as t">
                <ng-container *ngIf="box.tag.getDay()==1">

                  <ng-container class="zehn" *ngIf="klassenFahrt(box.fahrten,10)!==null">
                    <ng-container
                      *ngIf="t<7||(t>=7&&klassenFahrt(abschnitt[t-7].fahrten,10)===null)||(t>=7&&klassenFahrt(abschnitt[t].fahrten,10).titel!==klassenFahrt(abschnitt[t-7].fahrten,10).titel)">
                      <td class="fahrt" colSpan="{{klassenFahrtBreite(abschnitt,box,10,t)}}">

                        {{kuerzen(klassenFahrt(box.fahrten,10).titel)}}
                      </td>
                    </ng-container>
                  </ng-container>
                  <ng-container *ngIf="klassenFahrt(box.fahrten,10)===null">
                    <ng-container
                      *ngIf="t<6||(t>6&&breite(epo.zehn,abschnitt[t].tag,t, 'epoche',abschnitt)>=breite(epo.zehn,abschnitt[t-7].tag,t,'epoche',abschnitt))">
                      <td colSpan="{{breite(epo.zehn,abschnitt[t].tag,t, 'epoche', abschnitt)}}">
                        <!--           {{breite(epo.zehn,abschnitt[t].tag,t, 'epoche', abschnitt)}}-->
                        <div class="kuerzel">
                          <ng-container *ngFor="let ele of elementeDesTages(epo.zehn, box.tag, 'epoche')">
                            <span class="zehn {{markedd(ele.lehrer[0].kuerzel)}}">
                              {{ele.lehrer[0].kuerzel}}
                            </span>
                          </ng-container>
                        </div>
                        <div class="fach">
                          <ng-container
                            *ngFor="let ele of elementeDesTages(epo.zehn, box.tag, 'epoche') as item; index as k">
                            <span class="zehn {{markedd(ele.lehrer[0].kuerzel)}}"
                              *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                              {{ele.fach}}
                            </span>
                          </ng-container>
                        </div>
                      </td>
                    </ng-container>

                  </ng-container>
                </ng-container>
              </ng-container>
            </tr>

            <tr class="epoche" *ngIf="epochenElemente$|async as epo">
              <ng-container *ngFor="let box of abschnitt, index as t">
                <ng-container *ngIf="box.tag.getDay()==1">

                  <ng-container class="elf" *ngIf="klassenFahrt(box.fahrten,11)!==null">
                    <ng-container
                      *ngIf="t<7||(t>=7&&klassenFahrt(abschnitt[t-7].fahrten,11)===null)||(t>=7&&klassenFahrt(abschnitt[t].fahrten,11).titel!==klassenFahrt(abschnitt[t-7].fahrten,11).titel)">
                      <td class="fahrt" colSpan="{{klassenFahrtBreite(abschnitt,box,11,t)}}">

                        {{kuerzen(klassenFahrt(box.fahrten,11).titel)}}
                      </td>
                    </ng-container>
                  </ng-container>
                  <ng-container *ngIf="klassenFahrt(box.fahrten,11)===null">
                    <ng-container
                      *ngIf="t<6||(t>6&&breite(epo.elf,abschnitt[t].tag,t, 'epoche',abschnitt)>=breite(epo.elf,abschnitt[t-7].tag,t,'epoche',abschnitt))">
                      <td colSpan="{{breite(epo.elf,abschnitt[t].tag,t, 'epoche', abschnitt)}}">
                        <!--         {{breite(epo.elf,abschnitt[t].tag,t, 'epoche', abschnitt)}}-->
                        <div class="kuerzel">
                          <ng-container *ngFor="let ele of elementeDesTages(epo.elf, box.tag, 'epoche')">
                            <span class="elf {{markedd(ele.lehrer[0].kuerzel)}}">
                              {{ele.lehrer[0].kuerzel}}
                            </span>
                          </ng-container>
                        </div>
                        <div class="fach">
                          <ng-container
                            *ngFor="let ele of elementeDesTages(epo.elf, box.tag, 'epoche') as item; index as k">
                            <span class="elf {{markedd(ele.lehrer[0].kuerzel)}}"
                              *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                              {{ele.fach}}
                            </span>
                          </ng-container>
                        </div>
                      </td>
                    </ng-container>

                  </ng-container>
                </ng-container>
              </ng-container>
            </tr>
            <tr class="epoche" *ngIf="epochenElemente$|async as epo">
              <ng-container *ngFor="let box of abschnitt, index as t">
                <ng-container *ngIf="box.tag.getDay()==1">
                  <ng-container class="zwoelf" *ngIf="klassenFahrt(box.fahrten,12)!==null">
                    <ng-container
                      *ngIf="t<7||(t>=7&&klassenFahrt(abschnitt[t-7].fahrten,12)===null)||(t>=7&&klassenFahrt(abschnitt[t].fahrten,12).titel!==klassenFahrt(abschnitt[t-7].fahrten,12).titel)">
                      <td class="fahrt" colSpan="{{klassenFahrtBreite(abschnitt,box,12,t)}}">
                        {{kuerzen(klassenFahrt(box.fahrten,12).titel)}}
                      </td>
                    </ng-container>
                  </ng-container>
                  <ng-container *ngIf="klassenFahrt(box.fahrten,12)===null">
                    <ng-container
                      *ngIf="t<6||(t>6&&breite(epo.zwoelf,abschnitt[t].tag,t, 'epoche',abschnitt)>=breite(epo.zwoelf,abschnitt[t-7].tag,t,'epoche',abschnitt))">
                      <td colSpan="{{breite(epo.zwoelf,abschnitt[t].tag,t, 'epoche', abschnitt)}}">
                        <!--      {{breite(epo.zwoelf,abschnitt[t].tag,t, 'epoche', abschnitt)}}-->
                        <div class="kuerzel">
                          <ng-container *ngFor="let ele of elementeDesTages(epo.zwoelf, box.tag, 'epoche')">
                            <span class="zwoelf {{markedd(ele.lehrer[0].kuerzel)}}">
                              {{ele.lehrer[0].kuerzel}}
                            </span>
                          </ng-container>
                        </div>
                        <div class="fach">
                          <ng-container
                            *ngFor="let ele of elementeDesTages(epo.zwoelf, box.tag, 'epoche') as item; index as k">
                            <span class="zwoelf {{markedd(ele.lehrer[0].kuerzel)}}"
                              *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                              {{ele.fach}}
                            </span>
                          </ng-container>
                        </div>
                      </td>
                    </ng-container>

                  </ng-container>
                </ng-container>
              </ng-container>
            </tr>



            <tr>

            </tr>

            <tr class="schiene" *ngIf="schieneElemente$|async as epo">
              <ng-container *ngFor="let box of abschnitt, index as t">
                <ng-container *ngIf="box.tag.getDay()==1">
                  <ng-container class="neun" *ngIf="klassenFahrt(box.fahrten,9)!==null">
                    <ng-container
                      *ngIf="t<7||(t>=7&&klassenFahrt(abschnitt[t-7].fahrten,9)===null)||(t>=7&&klassenFahrt(abschnitt[t].fahrten,9).titel!==klassenFahrt(abschnitt[t-7].fahrten,9).titel)">
                      <td class="fahrt" colSpan="{{klassenFahrtBreite(abschnitt,box,9,t)}}">
                        {{kuerzen(klassenFahrt(box.fahrten,9).titel)}}
                      </td>
                    </ng-container>
                  </ng-container>
                  <ng-container *ngIf="klassenFahrt(box.fahrten,9)===null">
                    <ng-container
                      *ngIf="t<6||(t>6&&breite(epo.neun,abschnitt[t].tag,t, 'schiene',abschnitt)>=breite(epo.neun,abschnitt[t-7].tag,t,'schiene',abschnitt))">
                      <td colSpan="{{breite(epo.neun,abschnitt[t].tag,t, 'schiene', abschnitt)}}">
                        <!--     {{breite(epo.neun,abschnitt[t].tag,t, 'schiene', abschnitt)}}-->
                        <div class="kuerzel">
                          <ng-container *ngFor="let ele of elementeDesTages(epo.neun, box.tag, 'schiene')">
                            <span class="neun {{markedd(ele.lehrer[0].kuerzel)}}">
                              {{ele.lehrer[0].kuerzel}}
                            </span>
                          </ng-container>
                        </div>
                        <div class="fach">
                          <ng-container
                            *ngFor="let ele of elementeDesTages(epo.neun, box.tag, 'schiene') as item; index as k">
                            <span class="neun {{markedd(ele.lehrer[0].kuerzel)}}"
                              *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                              {{ele.fach}}
                            </span>
                          </ng-container>
                        </div>

                      </td>
                    </ng-container>

                  </ng-container>
                </ng-container>
              </ng-container>
            </tr>


            <tr class="schiene" *ngIf="schieneElemente$|async as epo">
              <ng-container *ngFor="let box of abschnitt, index as t">
                <ng-container *ngIf="box.tag.getDay()==1">

                  <ng-container class="zehn" *ngIf="klassenFahrt(box.fahrten,10)!==null">
                    <ng-container
                      *ngIf="t<7||(t>=7&&klassenFahrt(abschnitt[t-7].fahrten,10)===null)||(t>=7&&klassenFahrt(abschnitt[t].fahrten,10).titel!==klassenFahrt(abschnitt[t-7].fahrten,10).titel)">
                      <td class="fahrt" colSpan="{{klassenFahrtBreite(abschnitt,box,10,t)}}">
                        {{kuerzen(klassenFahrt(box.fahrten,10).titel)}}
                      </td>
                    </ng-container>
                  </ng-container>
                  <ng-container *ngIf="klassenFahrt(box.fahrten,10)===null">
                    <ng-container
                      *ngIf="t<6||(t>6&&breite(epo.zehn,abschnitt[t].tag,t, 'schiene',abschnitt)>=breite(epo.zehn,abschnitt[t-7].tag,t,'schiene',abschnitt))">
                      <td colSpan="{{breite(epo.zehn,abschnitt[t].tag,t, 'schiene', abschnitt)}}">
                        <!--   {{breite(epo.zehn,abschnitt[t].tag,t, 'schiene', abschnitt)}}-->
                        <div class="kuerzel">
                          <ng-container *ngFor="let ele of elementeDesTages(epo.zehn, box.tag, 'schiene')">
                            <span class="zehn {{markedd(ele.lehrer[0].kuerzel)}}">
                              {{ele.lehrer[0].kuerzel}}
                            </span>
                          </ng-container>
                        </div>
                        <div class="fach">
                          <ng-container
                            *ngFor="let ele of elementeDesTages(epo.zehn, box.tag, 'schiene') as item; index as k">
                            <span class="zehn {{markedd(ele.lehrer[0].kuerzel)}}"
                              *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                              {{ele.fach}}
                            </span>
                          </ng-container>
                        </div>
                      </td>
                    </ng-container>

                  </ng-container>
                </ng-container>
              </ng-container>
            </tr>
            <tr class="schiene" *ngIf="schieneElemente$|async as epo">
              <ng-container *ngFor="let box of abschnitt, index as t">
                <ng-container *ngIf="box.tag.getDay()==1">

                  <ng-container class="elf" *ngIf="klassenFahrt(box.fahrten,11)!==null">
                    <ng-container
                      *ngIf="t<7||(t>=7&&klassenFahrt(abschnitt[t-7].fahrten,11)===null)||(t>=7&&klassenFahrt(abschnitt[t].fahrten,11).titel!==klassenFahrt(abschnitt[t-7].fahrten,11).titel)">
                      <td class="fahrt" colSpan="{{klassenFahrtBreite(abschnitt,box,11,t)}}">
                        {{kuerzen(klassenFahrt(box.fahrten,11).titel)}}
                      </td>
                    </ng-container>
                  </ng-container>
                  <ng-container *ngIf="klassenFahrt(box.fahrten,11)===null">
                    <ng-container
                      *ngIf="t<6||(t>6&&breite(epo.elf,abschnitt[t].tag,t, 'schiene',abschnitt)>=breite(epo.elf,abschnitt[t-7].tag,t,'schiene',abschnitt))">
                      <td colSpan="{{breite(epo.elf,abschnitt[t].tag,t, 'schiene', abschnitt)}}">
                        <!--      {{breite(epo.elf,abschnitt[t].tag,t, 'schiene', abschnitt)}}-->
                        <div class="kuerzel">
                          <ng-container *ngFor="let ele of elementeDesTages(epo.elf, box.tag, 'schiene')">
                            <span class="elf {{markedd(ele.lehrer[0].kuerzel)}}">
                              {{ele.lehrer[0].kuerzel}}
                            </span>
                          </ng-container>
                        </div>
                        <div class="fach">
                          <ng-container
                            *ngFor="let ele of elementeDesTages(epo.elf, box.tag, 'schiene') as item; index as k">
                            <span class="elf {{markedd(ele.lehrer[0].kuerzel)}}"
                              *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                              {{ele.fach}}
                            </span>
                          </ng-container>
                        </div>
                      </td>
                    </ng-container>

                  </ng-container>
                </ng-container>
              </ng-container>
            </tr>

            <tr class="schiene" *ngIf="schieneElemente$|async as epo">
              <ng-container *ngFor="let box of abschnitt, index as t">
                <ng-container *ngIf="box.tag.getDay()==1">
                  <ng-container class="zwoelf" *ngIf="klassenFahrt(box.fahrten,12)!==null">
                    <ng-container
                      *ngIf="t<7||(t>=7&&klassenFahrt(abschnitt[t-7].fahrten,12)===null)||(t>=7&&klassenFahrt(abschnitt[t].fahrten,12).titel!==klassenFahrt(abschnitt[t-7].fahrten,12).titel)">
                      <td class="fahrt" colSpan="{{klassenFahrtBreite(abschnitt,box,12,t)}}">
                        {{kuerzen(klassenFahrt(box.fahrten,12).titel)}}
                      </td>
                    </ng-container>
                  </ng-container>
                  <ng-container *ngIf="klassenFahrt(box.fahrten,12)===null">
                    <ng-container
                      *ngIf="t<6||(t>6&&breite(epo.zwoelf,abschnitt[t].tag,t, 'schiene',abschnitt)>=breite(epo.zwoelf,abschnitt[t-7].tag,t,'schiene',abschnitt))">
                      <td colSpan="{{breite(epo.zwoelf,abschnitt[t].tag,t, 'schiene', abschnitt)}}">
                        <!--{{breite(epo.zwoelf,abschnitt[t].tag,t, 'schiene', abschnitt)}}-->
                        <div class="kuerzel">
                          <ng-container *ngFor="let ele of elementeDesTages(epo.zwoelf, box.tag, 'schiene')">
                            <span class="zwoelf {{markedd(ele.lehrer[0].kuerzel)}}">
                              {{ele.lehrer[0].kuerzel}}
                            </span>
                          </ng-container>
                        </div>
                        <div class="fach">
                          <ng-container
                            *ngFor="let ele of elementeDesTages(epo.zwoelf, box.tag, 'schiene') as item; index as k">
                            <span class="zwoelf {{markedd(ele.lehrer[0].kuerzel)}}"
                              *ngIf="(k==0||(k>0&&ele.fach!=item[k-1].fach))">
                              {{ele.fach}}
                            </span>
                          </ng-container>
                        </div>
                      </td>
                    </ng-container>

                  </ng-container>
                </ng-container>
              </ng-container>
            </tr>
          </table>
        </div>
      </ng-container>
    </ng-container>
  </div>

  <app-einzelplaene class="noprint"></app-einzelplaene>
